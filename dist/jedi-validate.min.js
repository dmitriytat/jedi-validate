!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JediValidate=t():e.JediValidate=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var s=r[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};return t.m=e,t.c=r,t.p="/dist/",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(1),c=n(u),l=r(2),d=r(3),f=r(5),p=r(6),h=r(7),v=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e);var s={ajax:{url:null,enctype:"application/x-www-form-urlencoded",sendType:"serialize",method:"GET"},rules:{},messages:{},containers:{parent:"form-group",message:"help-block",baseMessage:"base-error"},states:{error:"error",valid:"valid",pristine:"pristine",dirty:"dirty"},formStatePrefix:"jedi-",callbacks:{success:function(){},error:function(){}},clean:!0,redirect:!0,language:"en",translations:{}};this.root=t,this.options=(0,c["default"])(s,n),this.fields={},this.inputs={},this.messages={},this.data={},this.nodes=this.cacheNodes(this.root,this.options);var i=(0,f.getFormOptions)(this.nodes.form);this.options=(0,c["default"])(this.options,s),this.options=(0,c["default"])(this.options,i),this.options=(0,c["default"])(this.options,n),this.rules=a({},this.options.rules),(0,d.setLanguage)(this.options.language),Object.keys(this.options.translations).forEach(function(e){Object.keys(r.options.translations[e]).forEach(function(t){(0,d.addTranslation)(t,r.options.translations[e][t],e)})}),this.initMethods(),this.ready()}return i(e,[{key:"cacheNodes",value:function(e,t){return{form:e.querySelector("form"),inputs:e.querySelectorAll("[name]"),baseMessage:e.querySelector("."+t.containers.baseMessage)}}},{key:"ready",value:function(){var e=this;this.nodes.form.setAttribute("novalidate","novalidate"),this.nodes.form.addEventListener("submit",function(t){e.data=(0,l.getData)(e.inputs);var r=(0,p.validateData)(e.rules,e.methods,e.data,e.inputs,e.getErrorMessage.bind(e));if(r&&0!==Object.keys(r).filter(function(e){return r[e]}).length){Object.keys(r).forEach(function(t){return e.markField(e.fields[t],e.messages[t],e.options.states,r[t])});try{e.options.callbacks.error(r)}catch(n){console.error(n)}return void t.preventDefault()}if(e.options.ajax)t.preventDefault(),e.send(a({},e.options.ajax,{data:(0,l.convertData)(e.data,e.options.ajax.sendType,e.inputs)}));else try{e.options.callbacks.success(r,t)}catch(n){console.error(n)}}),this.nodes.inputs.forEach(function(t){var r=t.name;if(e.inputs[r])if(Array.isArray(e.inputs[r]))e.inputs[r].push(t);else{var n=[e.inputs[r],t];n.name=r,e.inputs[r]=n}else{e.inputs[r]=t;var s=t.parentNode;do{if(s.classList.contains(e.options.containers.parent)){e.fields[r]=s;break}s=s.parentNode}while(s);if(!e.fields[r])throw new Error("Have no parent field");e.fields[r].classList.add(e.options.states.pristine);var o=e.fields[r].querySelector("."+e.options.containers.message);o?e.messages[r]=o:(e.messages[r]=document.createElement("div"),e.messages[r].classList.add(e.options.containers.message),e.fields[r].appendChild(e.messages[r])),e.rules[r]=e.rules[r]||{};var i=(0,f.getInputRules)(t);e.rules[r]=(0,c["default"])(e.rules[r],i),Object.keys(e.rules[r]).forEach(function(t){e.rules[r][t]&&e.fields[r].classList.add(t)})}t.addEventListener("change",function(){e.fields[r].classList.remove(e.options.states.dirty);var n=(0,l.getInputData)(t),s=(0,l.getValueByName)(r,n);e.data=a({},e.data,n);var o=(0,p.validateField)(e.rules[r],e.methods,s,t,e.getErrorMessage.bind(e));e.markField(e.fields[r],e.messages[r],e.options.states,o)}),t.addEventListener("input",function(){e.fields[r].classList.remove(e.options.states.pristine),e.fields[r].classList.add(e.options.states.dirty)})})}},{key:"send",value:function(e){var t=this;(0,h.ajax)(e).then(function(e){if(e.validationErrors){try{t.options.callbacks.error(e.validationErrors)}catch(r){console.error(r)}e.validationErrors.base?(t.nodes.baseMessage.innerHTML=e.validationErrors.base.join(", "),t.root.classList.add(t.options.formStatePrefix+t.options.states.error),t.root.classList.remove(t.options.formStatePrefix+t.options.states.valid),delete e.validationErrors.base):t.nodes.baseMessage.innerHTML="",Object.keys(e.validationErrors).forEach(function(r){return t.markField(t.fields[r],t.messages[r],t.options.states,e.validationErrors[r])})}else{try{t.options.callbacks.success(e)}catch(r){console.error(r)}if(t.options.redirect&&e.redirect)return void(window.location.href=e.redirect);t.options.clean&&t.nodes.form.reset()}})["catch"](function(e){var r=e.method,n=e.url,s=e.status,o=e.statusText;console.warn(r+" "+n+" "+s+" ("+o+")"),t.nodes.baseMessage.innerHTML="Can not send form!",t.root.classList.add(t.options.formStatePrefix+t.options.states.error),t.root.classList.remove(t.options.formStatePrefix+t.options.states.valid)})}},{key:"markField",value:function(e,t,r,n){n&&n.length?this.markError(e,t,r,n):this.markValid(e,t,r)}},{key:"markError",value:function(e,t,r,n){var s=r.error,o=r.valid;e&&t&&(e.classList.add(s),e.classList.remove(o),t.innerHTML=n.join(", "))}},{key:"markValid",value:function(e,t,r){var n=r.error,s=r.valid;e&&t&&(e.classList.add(s),e.classList.remove(n),t.innerHTML="")}},{key:"getErrorMessage",value:function(e,t){var r="";return r=this.options.messages[e]&&this.options.messages[e][t]?this.options.messages[e][t]:this.methods[t].message}},{key:"addMethod",value:function(e,t,r){this.methods[e]={func:t,message:r}}},{key:"initMethods",value:function(){this.methods={},this.addMethod("required",function(e){return e&&""!==e.trim()},(0,d.translate)("This field is required")),this.addMethod("regexp",function(e,t,r){return r.test(e)},(0,d.translate)("Please, provide correct value")),this.addMethod("email",function(e){return/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i.test(e)},(0,d.translate)("This email is incorrect")),this.addMethod("filesize",function(e,t,r){return[].concat(s(t.files)).reduce(function(e,t){return t.size<r&&e},!0)},(0,d.translate)("This file is too large")),this.addMethod("extension",function(e,t,r){return[].concat(s(t.files)).reduce(function(e,t){return r.indexOf(t.name.split(".").pop())!==-1&&e},!0)},(0,d.translate)("This extension is not supported")),this.addMethod("tel",function(e){return/^([\+]+)*[0-9\x20\x28\x29\-]{5,20}$/.test(e)},(0,d.translate)("This phone number is incorrect")),this.addMethod("url",function(e){return/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/gi.test(e)},(0,d.translate)("Wrong url"))}}],[{key:"addToDictionary",value:function(e,t,r){(0,d.addTranslation)(e,t,r)}}]),e}();e.exports=v},function(e,t,r){var n,s;!function(o,a){n=a,s="function"==typeof n?n.call(t,r,t,e):n,!(void 0!==s&&(e.exports=s))}(this,function(){function e(e){var t=e&&"object"==typeof e;return t&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)}function t(e){return Array.isArray(e)?[]:{}}function r(r,n){var s=n&&n.clone===!0;return s&&e(r)?o(t(r),r,n):r}function n(t,n,s){var a=t.slice();return n.forEach(function(n,i){"undefined"==typeof a[i]?a[i]=r(n,s):e(n)?a[i]=o(t[i],n,s):t.indexOf(n)===-1&&a.push(r(n,s))}),a}function s(t,n,s){var a={};return e(t)&&Object.keys(t).forEach(function(e){a[e]=r(t[e],s)}),Object.keys(n).forEach(function(i){e(n[i])&&t[i]?a[i]=o(t[i],n[i],s):a[i]=r(n[i],s)}),a}function o(e,t,o){var a=Array.isArray(t),i=o||{arrayMerge:n},u=i.arrayMerge||n;return a?Array.isArray(e)?u(e,t,o):r(t,o):s(e,t,o)}return o})},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=e[0];return 0===r.length?t:"[]"===r?[a(e.slice(1),t)]:o({},r,a(e.slice(1),t))}function i(e,t){var r=d(e);return u(r,t)}function u(e,t){return e.reduce(function(e,t){return t&&e?e[t]:e},t||"")}function c(e){return[].concat(s(e)).map(function(e){return l(e)}).filter(Boolean)[0]}function l(e){if(e){var t=e.type;if(Array.isArray(e))return c(e);switch(t){case"select-one":return e.options.length?e.options[e.selectedIndex].value:"";case"select-multiple":return e.options.filter(function(e){return e.selected}).map(function(e){return e.value});case"checkbox":case"radio":return e.checked?e.value:"";default:return e.value}}}function d(e){for(var t=[],r=b.exec(e);null!==r;)r.index===b.lastIndex&&(b.lastIndex+=1),t.push(r[2]||r[1]),r=b.exec(e);return t}function f(e){var t=l(e),r=d(e.name);return a(r,t)}function p(e){return Object.keys(e).reduce(function(t,r){return(0,g["default"])(t,f(e[r]))},{})}function h(e,t,r){switch(t){case"serialize":var n=Object.keys(e).reduce(function(t,r){return""+t+v(r,e[r])},"");return n.length?n.slice(0,-1):"";case"formData":return Object.keys(e).reduce(function(e,t){if(r[t]&&r[t].type&&"file"===r[t].type)if(r[t].hasAttribute("multiple"))for(var n=0;n<r[t].files.length;n+=1)e.append(t+"[]",r[t].files[n]);else e.append(t,r[t].files[0]);else e.append(t,l(r[t]));return e},new FormData);case"json":default:return JSON.stringify(e)}}function v(e,t){return Array.isArray(t)?t.reduce(function(r,n){return r+v(e+"["+n+"]",t[n])},""):"object"===("undefined"==typeof t?"undefined":y(t))?Object.keys(t).reduce(function(r,n){return r+v(e+"["+n+"]",t[n])},""):e+"="+encodeURIComponent(t)+"&"}Object.defineProperty(t,"__esModule",{value:!0});var y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.createObject=a,t.getValueByName=i,t.getValueByPath=u,t.getRadioGroupValue=c,t.getInputValue=l,t.convertNameToPath=d,t.getInputData=f,t.getData=p,t.convertData=h,t.getQueryPart=v;var m=r(1),g=n(m),b=/(\[(\w*)\]|\w*)/gi},function(e,t,r){"use strict";function n(e){i=e}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i;return a[t]&&a[t][e]||e}function o(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i;void 0===a[r]&&(a[r]={}),a[r][e]=t}Object.defineProperty(t,"__esModule",{value:!0}),t.setLanguage=n,t.translate=s,t.addTranslation=o;var a=r(4),i="en"},function(e,t){e.exports={ru:{"This field is required":"Это поле необходимо заполнить","Please, provide correct value":"Пожалуйста, введите корректное значение","This email is incorrect":"Пожалуйста, введите корректный адрес электронной почты","This file is too large":"Попробуйте загрузить файл поменьше","This extension is not supported":"Пожалуйста, выберите файл с правильным расширением","This phone number is incorrect":"Не корректный номер телефона","Wrong url":"Не корректный url"}}},function(e,t){"use strict";function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){var t={url:e.getAttribute("action"),method:e.getAttribute("method"),enctype:e.getAttribute("enctype")};return{ajax:o({},t,{sendType:"multipart/form-data"===t.enctype?"formData":void 0})}}function s(e){var t=["required","email","tel","url"],n=t.reduce(function(t,n){return o({},t,r({},n,e.hasAttribute(n)||e.type===n||e.classList.contains(n)))},{});return o({},n,{regexp:e.hasAttribute("pattern")?new RegExp(e.getAttribute("pattern")):void 0})}Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.getFormOptions=n,t.getInputRules=s},function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t,r,n,s){if(!n)return[];var o=n.name,a=!t.required.func(r,n);return a&&e.required?[s(o,"required")]:a?[]:Object.keys(e).reduce(function(a,i){var u=e[i];if(!u)return a;if(t[i]){var c=t[i].func(r,n,u);c||a.push(s(o,i))}else a.push('Method "'+i+'" not found');return a},[])}function o(e,t,r,o,u){return Object.keys(e).reduce(function(c,l){var d=(0,i.getValueByName)(l,r),f=s(e[l],t,d,o[l],u);return a({},c,n({},l,f.length?f:void 0))},{})}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.validateField=s,t.validateData=o;var i=r(2)},function(e,t){"use strict";function r(e){return new Promise(function(t,r){var n=new XMLHttpRequest;n.open(e.method,e.url+("GET"===e.method.toUpperCase()?"?"+e.data:""),!0),"serialize"===e.sendType?n.setRequestHeader("Content-type",e.enctype):"json"===e.sendType&&n.setRequestHeader("Content-type","application/json; charset=utf-8"),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){var s={};try{s=JSON.parse(n.responseText)}catch(o){s.validationErrors={base:["JSON parsing error"]}}t(s)}else r({xhr:n,method:e.method,url:e.url,status:n.status,statusText:n.statusText})},n.send("POST"===e.method.toUpperCase()?e.data:"")})}Object.defineProperty(t,"__esModule",{value:!0}),t.ajax=r}])});
//# sourceMappingURL=jedi-validate.min.js.map